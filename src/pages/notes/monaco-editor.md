# Monaco Editor

[[VSCode]] [[Gatsby]] [[Gatsby Theme]]

[Monaco Editor](https://github.com/microsoft/monaco-editor)
[React Monaco Editor](https://github.com/react-monaco-editor/react-monaco-editor)
[Monaco Editor Webpack Plugin](https://github.com/Microsoft/monaco-editor-webpack-plugin)

Swyx's [post](https://www.swyx.io/writing/how-to-add-monaco-editor-to-a-next-js-app-ha3), but only for [[Next.js]] implementation.

## First look

Add

```js
// gatsby-node.js

const MonacoWebpackPlugin = require('monaco-editor-webpack-plugin')

exports.onCreateWebpackConfig = ({ actions }) => {
  actions.setWebpackConfig({
    plugins: [
      new MonacoWebpackPlugin({
        languages: [
          'json',
          'markdown',
          'css',
          'typescript',
          'javascript',
          'html',
          'graphql',
        ],
        filename: 'static/[name].worker.js',
      }),
    ],
  })
}
```

and

```js
// page.tsx

import MonacoEditor from 'react-monaco-editor'

const Page = () => {
  const [postBody, setPostBody] = React.useState('')

  return (
    <MonacoEditor
      editorDidMount={() => {
        // @ts-ignore
        window.MonacoEnvironment.getWorkerUrl = (
          _moduleId: string,
          label: string
        ) => {
          if (label === 'json') return 'static/json.worker.js'
          if (label === 'css') return 'static/css.worker.js'
          if (label === 'html') return 'static/html.worker.js'
          if (label === 'typescript' || label === 'javascript')
            return 'static/ts.worker.js'
          return 'static/editor.worker.js'
        }
      }}
      width="800"
      height="600"
      language="markdown"
      theme="vs-dark"
      value={postBody}
      options={{
        minimap: {
          enabled: true,
        },
      }}
      onChange={setPostBody}
    />
  )
}
```

### It work at Development

But [[Gatsby Cloud]] build failed:

```
...
15:41:10 PM: success run queries - 287.458s - 38/38 0.13/s
15:41:31 PM: failed Building static HTML for pages - 20.029s
15:41:31 PM: error Building static HTML failed
15:41:31 PM:  > 1 | self["MonacoEnvironment"] = (function (paths) { | ^ 2 | function stripTrailingSlash(str) { 3 | return str.replace(/\/$/, ''); 4 | } WebpackError: ReferenceError: self is not defined - editor.api.js?dc7f:1 Object../include-loader!./node_modules/monaco-editor/es m/vs/editor/editor.api.js node_modules/monaco-editor/esm/vs/editor/editor.api.js?dc7f:1:1 - editor.js:8 Object../node_modules/react-monaco-editor/lib/editor.js node_modules/react-monaco-editor/lib/editor.js:8:38 - index.js:19 Object../node_modules/react-monaco-editor/lib/index.js node_modules/react-monaco-editor/lib/index.js:19:38 - page-2.tsx:1 Module../src/pages/page-2.tsx src/pages/page-2.tsx:1:1
15:41:31 PM: not finished Generating image thumbnails - 308.119s

```

### Fix

Just use `@loadable/component` [Github](https://github.com/hector-del-rio/gatsby-plugin-loadable-components-ssr)

`npm install --save gatsby-plugin-loadable-components-ssr`
`npm install --save @loadable/component`

```js
// gatsby-browser.js

const loadableReady = require('@loadable/component').loadableReady

exports.replaceHydrateFunction = () => {
  return (element, container, callback) => {
    loadableReady(() => {
      ReactDOM.render(element, container, callback)
    })
  }
}
```

```js
// page.tsx

import loadable from '@loadable/component'
const MonacoEditor = loadable(() => import('react-monaco-editor'), { ssr: false })

...
return (
  ...
  { MonacoEditor && <MonacoEditor.default /> }
  ...
)
```

### Finally, it work!

## TODO

Make [[Gatsby Recipes]]?

[//begin]: # "Autogenerated link references for markdown compatibility"
[VSCode]: vscode "VSCode"
[Gatsby]: gatsby "Gatsby"
[Gatsby Theme]: gatsby-theme "Gatsby Theme"
[//end]: # "Autogenerated link references"